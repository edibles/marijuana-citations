{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Marijuana citations in Connecticut analysis\"\nauthor: \"Andrew Ba Tran\"\ndate: \"September 25, 2016\"\noutput: html_document\n---\n\n\nThis is the exploratory visualizaton behind the Trend CT story: [Who in CT is being cited for marijuana possession and by whom?](http://trendct.org/2016/09/26/where-connecticut-residents-have-been-arrested-the-most-for-marijuana-poessession/).\n\nVisit the [repo](https://github.com/trendct-data/marijuana-citations/) for the [data](https://github.com/trendct-data/marijuana-citations/tree/master/data) used in this analysis. (Also, check out the reproducible scripts and data behind many of our other stories in our [central data stories repo](https://github.com/trendct-data))\n\nThe data used in this analysis (marijuana citations between 2011 and 2014) is from the Connecticut State Police via a FOIA request made by [Evan Anderson](https://www.muckrock.com/news/archives/2015/apr/29/new-york-still-throes-reefer-madness/) via [Muckrock.com](https://www.muckrock.com/foi/connecticut-53/connecticut-marijuana-citation-data-2011-2014-16701/).\n\nWhatâ€™s in this walkthrough\n\nExploratory analysis and visualizations of marijuana citations.\n\n\n\n```{r setup, warning=F, message=F}\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(extrafont)\nlibrary(ggalt)\nlibrary(scales)\nlibrary(gridExtra)\nlibrary(grid)\nlibrary(knitr)\n#install.packages(\"devtools\")\n#devtools::install_github(\"trendct/ctnamecleaner\")\nlibrary(ctnamecleaner)\n#devtools::install_github(\"hrecht/censusapi\")\nlibrary(\"censusapi\")\nsource(\"keys.R\")\n```\n\n### Loading and prepping the data\n\n```{r loading_data, warning=F, message=F}\n\nmj <- read.csv(\"data/15-218_Marijuana_Arrests_by_Agency_2011-2013_NIBRS.csv\", stringsAsFactors=F)\n\ncolnames(mj) <- c(\"date\", \"description\", \"gender\", \"race\", \"ethnicity\", \"age\")\n\nmj2 <- filter(mj,\n              date!=\"\" &\n              !grepl(\"Unit of\", date) &\n              !grepl(\"NSS \", date) &\n              !grepl(\"Report \", date) &\n              !grepl(\"Arrests \", date) &\n              !grepl(\"IncidentDate\", date)\n                )\n\nmj2$department <- \"temp\"\n\ndepartment_name <- \"temp\"\n\nfor (i in 1:nrow(mj2)) {\n  #print(i)\n  department_name <- ifelse(grepl(\"/\", mj2$date[i]), department_name, mj2$date[i])\n  mj2$department[i] <- department_name\n  #print( mj2$department[i] )\n}\n\nmj2 <- mj2 %>%\n  filter(gender==\"M\" | gender==\"F\")\n\nmj2$date <- mdy(mj2$date)\nmj2$year <- year(mj2$date)\nmj2$month <- month(mj2$date)\n```\n\n## Men and women\n\n```{r men_women, warning=F, message=F}\n\nmj_sex <- mj2 %>%\n  group_by(gender) %>%\n  summarise(citations=n())\n\nkable(mj_sex)\n```\n\n## Age distribution\n\n```{r ages, fig.width=9, fig.height=6}\nmj2$age <- as.numeric(mj2$age)\n\nggplot(mj2, aes(mj2$age)) + geom_histogram(binwidth=1, aes(fill = ..count..)) + ggtitle(\"Marijuana citations by age in Connecticut\")\n\n```\n\n\n## Departments that arrested the most \n\n```{r most, warning=F, message=F}\n\nmj_most <- mj2 %>%\n  group_by(department) %>%\n  summarise(arrests=n()) %>%\n  arrange(-arrests)\n\nkable(head(mj_most, 10))\n\n```\n\n## After adjusting for population\n\n```{r adjusting, warning=F, message=F}\n\nmj_most$town <- gsub(\" Police Department\", \"\", mj_most$department)\nmj_most$town <- gsub(\" Police Dept.\", \"\", mj_most$town)\n\nmj_most2 <- ctpopulator(town, mj_most)\n\nnon_mj_most <- subset(mj_most2, is.na(pop2013))\n\nmj_most2_map <- subset(mj_most2, !is.na(pop2013))\nmj_most2_map$per_capita <- (mj_most2_map$arrests/mj_most2_map$pop2013)*10000\n\nmj_most2_map <- mj_most2_map[c(\"town\", \"per_capita\", \"arrests\")]\ncolnames(mj_most2_map) <- c(\"Town\", \"Per capita arrests\", \"Total arrests\")\n\nmj_most2_map$Town <- str_to_title(mj_most2_map$Town)\nmj_most2_map <- arrange(mj_most2_map, -`Per capita arrests`)\nkable(head(mj_most2_map,10))\n```\n\n\n## Arrests over time by department (total)\n\n```{r overtime1, warning=F, message=F, fig.width=9, fig.height=20}\n\nmj_arrests_years <- mj2 %>%\n  group_by(department, year) %>%\n  summarise(arrests=n())\n\nmj_arrests_years$town <- gsub(\" Police Department\", \"\", mj_arrests_years$department)\nmj_arrests_years$town <- gsub(\" Police Dept.\", \"\", mj_arrests_years$town)\n\nmj_arrests_years <- ctpopulator(town, mj_arrests_years)\nmj_arrests_years2 <- subset(mj_arrests_years, !is.na(pop2013))\nmj_arrests_years2$per_capita <- mj_arrests_years2$arrests/mj_arrests_years2$pop2013*10000\n\n\ngg <- ggplot(mj_arrests_years, aes(x=year, y=arrests)) \ngg <- gg + geom_bar(stat=\"identity\") \ngg <- gg + facet_wrap(~department, ncol = 3)\ngg <- gg + labs(x=NULL, y=NULL, title=\"Total marijuana citations\",\n                subtitle=\"Between 2011 and 2014.\",\n                caption=\"SOURCE: National Incident-Based Reporting System, U.S. Census \\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Lato Regular\")\ngg <- gg + theme(axis.ticks.y=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(legend.key=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Regular\", size=22))\ngg <- gg + theme(plot.caption=element_text(face=\"bold\", family=\"Lato Regular\", size=9, color=\"gray\", margin=margin(t=10, r=80)))\ngg <- gg + theme(legend.position=\"none\")\ngg\n```\n\n## Arrests over time by department (per capita)\n\n```{r overtime2, warning=F, message=F, fig.width=9, fig.height=20}\n\ngg <- ggplot(mj_arrests_years2, aes(x=year, y=per_capita)) \ngg <- gg + geom_bar(stat=\"identity\") \ngg <- gg + facet_wrap(~department, ncol = 3)\ngg <- gg + labs(x=NULL, y=NULL, title=\"Per capita marijuana citations\",\n                subtitle=\"Per 10,000 residents. Between 2011 and 2014.\",\n                caption=\"SOURCE: National Incident-Based Reporting System, U.S. Census \\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Lato Regular\")\ngg <- gg + theme(axis.ticks.y=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(legend.key=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Regular\", size=22))\ngg <- gg + theme(plot.caption=element_text(face=\"bold\", family=\"Lato Regular\", size=9, color=\"gray\", margin=margin(t=10, r=80)))\ngg <- gg + theme(legend.position=\"none\")\ngg\n\n```\n\n```{r most_arrests_year, warning=F, message=F}\n\nmj_arrests_years <- mj2 %>%\n  group_by(department, year) %>%\n  summarise(arrests=n()) %>%\n  spread(year, arrests) %>%\n  mutate(per_change=round((`2013` - `2011`) / `2011` *100, 2)) %>%\n  arrange(-per_change)\n\nkable(head(mj_arrests_years,10))\n```\n\n## Arrests by race by department\n\n```{r arrests_race_dept, warning=F, message=F, fig.width=9, fig.height=20}\n\nmj2$race_ethnicity <- ifelse(mj2$ethnicity==\"H\", \"Hispanic\", mj2$race)\nmj2$race_ethnicity <- ifelse(mj2$race_ethnicity==\"A\", \"Asian\", mj2$race_ethnicity)\nmj2$race_ethnicity <- ifelse(mj2$race_ethnicity==\"B\", \"Black\", mj2$race_ethnicity)\nmj2$race_ethnicity <- ifelse(mj2$race_ethnicity==\"W\", \"White\", mj2$race_ethnicity)\n\nmj2$race_ethnicity <- ifelse(mj2$race_ethnicity==\"I\", \"Indian\", mj2$race_ethnicity)\nmj2$race_ethnicity <- ifelse(mj2$race_ethnicity==\"U\", \"Unknown\", mj2$race_ethnicity)\n\n\nmj_arrests_race <- mj2 %>%\n  group_by(department, race_ethnicity) %>%\n  summarise(arrests=n())\n\n## chart\nggplot(mj_arrests_race, aes(x=race_ethnicity, y=arrests)) + geom_bar(stat=\"identity\") + coord_flip() + facet_wrap(~department, ncol = 4, scales = \"free_x\")\n```\n\n### Bringing in census population data\n\n```{r population, warning=F, message=F}\n\n# B02001_001E - Total\n# B02001_002E - White\n# B02001_003E - Black\n# B02001_004E - Indian\n# B02001_005E - Asian\n# B03001_003E - Hispanic\n\nrace_towns <- getCensus(name=\"acs5\",\n                         vintage=2014,\n                         key=census_key,\n                         vars=c(\"NAME\", \"B02001_001E\", \"B02001_002E\", \"B02001_003E\",\n                                \"B02001_004E\", \"B02001_005E\", \"B03001_003E\"),\n                         region=\"county subdivision:*\", regionin=\"state:09\")\n\ncolnames(race_towns) <- c(\"town\", \"state\", \"county\", \"countysub\", \"total_pop\", \"White\", \"Black\", \"Indian\", \"Asian\", \"Hispanic\")\nrace_towns <- race_towns[c(\"town\", \"total_pop\", \"White\", \"Black\", \"Indian\", \"Asian\", \"Hispanic\")]\nrace_towns <- subset(race_towns, !grepl(\"County subdivisions\", town))\nrace_towns$town <- gsub(\" town.*\", \"\", race_towns$town)\n\nrace_towns_long <- race_towns %>%\n  gather(\"race_ethnicity\", \"population\", 3:7) %>%\n  mutate(percent_population=round(population/total_pop*100,2))\n```\n\n## Percent of tickets by race compared to percent of population by race\n\n```{r comparison, warning=F, message=F, fig.width=9, fig.height=6}\n\n\nmj_arrests_race_spread <- mj_arrests_race %>%\n  group_by(department) %>%\n  mutate(total=sum(arrests, na.rm=T), percent=round(arrests/total*100,2))\n\nmj_arrests_race_spread$town <- gsub(\" Police Department\", \"\", mj_arrests_race_spread$department)\nmj_arrests_race_spread$town <- gsub(\" Police Dept.\", \"\", mj_arrests_race_spread$town)\n\n\n\nmj_arrests_race_spread <- left_join(mj_arrests_race_spread, race_towns_long)\n\nmj_arrests_filtered <- subset(mj_arrests_race_spread, !is.na(total_pop))\nmj_arrests_filtered <- filter(mj_arrests_filtered, race_ethnicity!=\"Indian\")\n\nmj_filtered <- mj_arrests_filtered[c (\"percent\", \"percent_population\")]\n\ngg <- ggplot(mj_arrests_filtered, aes(percent, percent_population)) \ngg <- gg + geom_abline(intercept = 1, color=\"grey65\")\ngg <- gg + geom_point(data = mj_filtered, color = \"grey85\") \ngg <- gg + geom_point(aes(color=race_ethnicity)) \ngg <- gg + facet_wrap(~race_ethnicity, ncol=4)\ngg <- gg + labs(y=\"Percent population\", x=\"Percent cited\", \n                title=\"Marijuana citations by race compared to town's population\", \n                subtitle=\"Minorities tend to be cited disproportionately to the proportion of the population of the towns they live in.\\nBased on citations between 2011 and 2014.\", \n                caption=\"SOURCE: National Incident-Based Reporting System, U.S. Census \\nAndrew Ba Tran/TrendCT.org\")\ngg <- gg + theme_bw(base_family=\"Lato Regular\")\ngg <- gg + theme(axis.ticks.y=element_blank())\ngg <- gg + theme(panel.border=element_blank())\ngg <- gg + theme(legend.key=element_blank())\ngg <- gg + theme(plot.title=element_text(face=\"bold\", family=\"Lato Regular\", size=22))\ngg <- gg + theme(plot.caption=element_text(face=\"bold\", family=\"Lato Regular\", size=9, color=\"gray\", margin=margin(t=10, r=80)))\ngg <- gg + theme(legend.position=\"none\")\ngg\n\n```\n\n\n\n",
    "created" : 1474856206845.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3086243337",
    "id" : "A6A57A86",
    "lastKnownWriteTime" : 1474862031,
    "last_content_update" : 1474862031699,
    "path" : "~/Documents/Github/trendct-data/2016/09/marijuana-arrests/index.Rmd",
    "project_path" : "index.Rmd",
    "properties" : {
        "source_window_id" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}